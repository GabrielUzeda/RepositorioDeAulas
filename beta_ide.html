<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Online - Terminal Integrado</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-palenight.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #1976D2;
            --primary-dark: #1565C0;
            --primary-light: #42A5F5;
            --accent: #FF4081;
            --success: #4CAF50;
            --error: #F44336;
            --warning: #FF9800;
            --bg-primary: #FAFAFA;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F5F5F5;
            --text-primary: #212121;
            --text-secondary: #757575;
            --border: #E0E0E0;
            --shadow: rgba(0, 0, 0, 0.1);
            --terminal-bg: #263238;
            --terminal-text: #ECEFF1;
        }
        
        [data-theme="dark"] {
            --primary: #42A5F5;
            --primary-dark: #1E88E5;
            --primary-light: #64B5F6;
            --accent: #FF4081;
            --success: #66BB6A;
            --error: #EF5350;
            --warning: #FFA726;
            --bg-primary: #121212;
            --bg-secondary: #1E1E1E;
            --bg-tertiary: #2C2C2C;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --border: #333333;
            --shadow: rgba(0, 0, 0, 0.3);
            --terminal-bg: #1E1E1E;
            --terminal-text: #E0E0E0;
        }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background: var(--bg-primary);
            height: 100vh; 
            overflow: hidden; 
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container { 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            max-width: 1800px; 
            margin: 0 auto; 
            padding: 16px; 
            gap: 16px; 
        }
        
        .header { 
            background: var(--bg-secondary);
            padding: 16px 24px; 
            border-radius: 4px;
            box-shadow: 0 2px 4px var(--shadow);
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: background-color 0.3s ease;
        }
        
        .header h1 { 
            color: var(--text-primary);
            font-size: 20px; 
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .status { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 14px; 
            color: var(--text-secondary);
        }
        
        .status-dot { 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            background: var(--warning);
            animation: pulse 2s infinite; 
        }
        
        .status-dot.ready { 
            background: var(--success);
            animation: none; 
        }
        
        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.5; } 
        }
        
        .theme-toggle {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        
        .theme-toggle:hover {
            background: var(--bg-tertiary);
        }
        
        .theme-toggle .material-icons {
            font-size: 24px;
        }
        
        .main-content { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 16px; 
            flex: 1; 
            min-height: 0; 
        }
        
        .panel { 
            background: var(--bg-secondary);
            border-radius: 4px;
            box-shadow: 0 2px 4px var(--shadow);
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            transition: background-color 0.3s ease;
        }
        
        .panel-header { 
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
            font-weight: 500;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .panel-header span {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .panel-content { 
            flex: 1; 
            overflow: auto; 
            padding: 0; 
            display: flex; 
            flex-direction: column; 
        }
        
        .CodeMirror { 
            height: 100%; 
            font-size: 14px; 
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        .controls { 
            display: flex; 
            gap: 8px; 
        }
        
        .btn { 
            padding: 6px 16px;
            border: none; 
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer; 
            transition: all 0.2s ease;
            font-size: 13px; 
            display: flex; 
            align-items: center; 
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Roboto', sans-serif;
        }
        
        .btn .material-icons {
            font-size: 18px;
        }
        
        .btn-run { 
            background: var(--success);
            color: white; 
        }
        
        .btn-run:hover { 
            background: #45a049;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
        }
        
        .btn-run:disabled { 
            background: var(--border);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .btn-clear { 
            background: var(--error);
            color: white; 
        }
        
        .btn-clear:hover { 
            background: #e53935;
            box-shadow: 0 2px 4px rgba(244, 67, 54, 0.3);
        }
        
        .btn-example { 
            background: var(--primary);
            color: white; 
        }
        
        .btn-example:hover { 
            background: var(--primary-dark);
            box-shadow: 0 2px 4px rgba(25, 118, 210, 0.3);
        }
        
        .terminal-container { 
            display: flex; 
            flex-direction: column; 
            height: 100%; 
            background: var(--terminal-bg);
            color: var(--terminal-text);
            font-family: 'Courier New', monospace; 
            overflow: hidden;
            transition: background-color 0.3s ease;
        }
        
        .terminal-header { 
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: background-color 0.3s ease;
        }
        
        .terminal-title { 
            font-weight: 500;
            color: var(--text-primary);
            font-size: 13px;
        }
        
        .terminal-controls { 
            display: flex; 
            gap: 6px; 
        }
        
        .terminal-control { 
            width: 10px; 
            height: 10px; 
            border-radius: 50%; 
        }
        
        .terminal-control.close { background: var(--error); }
        .terminal-control.minimize { background: var(--warning); }
        .terminal-control.maximize { background: var(--success); }
        
        .terminal-content { 
            flex: 1; 
            padding: 12px;
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
        }
        
        .terminal-line { 
            margin: 2px 0; 
            line-height: 1.5;
            white-space: pre-wrap; 
            word-break: break-word; 
        }
        
        .terminal-prompt-text { 
            color: var(--terminal-text);
            margin-right: 8px; 
        }
        
        .terminal-input-line { 
            display: flex; 
            align-items: center; 
        }
        
        .terminal-input { 
            flex: 1; 
            background: transparent; 
            border: none; 
            color: var(--terminal-text);
            font-family: 'Courier New', monospace; 
            font-size: 14px; 
            outline: none; 
        }
        
        .terminal-output { color: var(--terminal-text); }
        .terminal-error { color: var(--error); }
        .terminal-success { color: var(--success); }
        
        .plot-container { 
            padding: 16px;
            display: flex; 
            flex-direction: column; 
            gap: 16px;
            align-items: center; 
            overflow-y: auto;
            background: var(--bg-secondary);
        }
        
        .plot-container img { 
            max-width: 100%; 
            border-radius: 4px;
            box-shadow: 0 2px 8px var(--shadow);
        }
        
        .plot-container.empty { 
            justify-content: center; 
            color: var(--text-secondary);
            font-style: italic; 
        }
        
        .tabs { 
            display: flex; 
            gap: 4px; 
        }
        
        .tab { 
            padding: 8px 16px;
            background: transparent;
            border: none; 
            color: var(--text-secondary);
            cursor: pointer; 
            border-radius: 4px 4px 0 0;
            font-weight: 500;
            transition: all 0.2s ease;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .tab .material-icons {
            font-size: 18px;
        }
        
        .tab.active { 
            background: var(--bg-tertiary);
            color: var(--primary);
        }
        
        .tab:hover:not(.active) { 
            background: var(--bg-tertiary);
            opacity: 0.7;
        }
        
        .tab-content { 
            display: none; 
            flex: 1; 
            flex-direction: column; 
            overflow: hidden; 
        }
        
        .tab-content.active { 
            display: flex; 
        }
        
        .loading-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: var(--bg-primary);
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
            color: var(--text-primary);
        }
        
        .loading-spinner { 
            width: 48px; 
            height: 48px; 
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        
        .loading-text { 
            margin-top: 24px;
            font-size: 16px; 
            font-weight: 500;
        }
        
        .loading-subtext { 
            margin-top: 8px;
            font-size: 14px; 
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando Python...</div>
        <div class="loading-subtext">Inicializando Pyodide e bibliotecas cient√≠ficas</div>
    </div>

    <div class="container">
        <div class="header">
            <h1>
                <span class="material-icons">code</span>
                Python Online Compiler
            </h1>
            <div class="header-right">
                <div class="status">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Carregando...</span>
                </div>
                <button class="theme-toggle" id="themeToggle" onclick="pythonCompiler.toggleTheme()">
                    <span class="material-icons">dark_mode</span>
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <div class="panel-header">
                    <span>
                        <span class="material-icons">edit_note</span>
                        Editor de C√≥digo
                    </span>
                    <div class="controls">
                        <button class="btn btn-example" onclick="pythonCompiler.loadExample()">
                            <span class="material-icons">lightbulb</span>
                            Exemplo
                        </button>
                        <button class="btn btn-run" id="runBtn" onclick="pythonCompiler.runCode()" disabled>
                            <span class="material-icons">play_arrow</span>
                            Executar
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <textarea id="codeEditor"># Bem-vindo ao Python Online Compiler com Terminal!
# Lembre-se de usar "await" antes de cada "input()"
import matplotlib.pyplot as plt
import numpy as np

print("üöÄ Sistema Iniciado com Sucesso!")
print("=" * 50)

# Entrada de dados pelo terminal (usando await)
nome = await input("Digite seu nome: ")
print(f"Ol√°, {nome}! Bem-vindo ao Python Online!")

idade = int(await input("Digite sua idade: "))
print(f"Voc√™ tem {idade} anos. Em 10 anos ter√° {idade + 10} anos!")

print(f"\n‚úÖ Processamento conclu√≠do para {nome}!")</textarea>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="tabs">
                        <button class="tab active" onclick="pythonCompiler.switchTab('terminal')">
                            <span class="material-icons">terminal</span>
                            Terminal
                        </button>
                        <button class="tab" onclick="pythonCompiler.switchTab('plots')">
                            <span class="material-icons">insert_chart</span>
                            Gr√°ficos
                        </button>
                    </div>
                    <button class="btn btn-clear" onclick="pythonCompiler.clearTerminal()">
                        <span class="material-icons">delete</span>
                        Limpar
                    </button>
                </div>
                <div class="panel-content">
                    <div id="terminalTab" class="tab-content active">
                        <div class="terminal-container">
                            <div class="terminal-header">
                                <div class="terminal-title">Python Terminal</div>
                                <div class="terminal-controls">
                                    <div class="terminal-control close"></div>
                                    <div class="terminal-control minimize"></div>
                                    <div class="terminal-control maximize"></div>
                                </div>
                            </div>
                            <div class="terminal-content" id="terminalContent">
                            </div>
                        </div>
                    </div>
                    <div id="plotsTab" class="tab-content">
                        <div id="plots" class="plot-container empty">Os gr√°ficos aparecer√£o aqui...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const pythonCompiler = {
            pyodide: null, 
            editor: null, 
            isExecuting: false, 
            inputResolver: null,
            currentTheme: 'auto',
            
            async init() {
                try {
                    this.initTheme();
                    this.editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), { 
                        mode: 'python', 
                        theme: this.getEditorTheme(), 
                        lineNumbers: true, 
                        indentUnit: 4 
                    });
                    this.clearTerminal();
                    await this.loadPyodide();
                    this.updateStatus('ready', 'Pronto');
                    document.getElementById('runBtn').disabled = false;
                    document.getElementById('loadingOverlay').style.display = 'none';
                } catch (error) {
                    this.updateStatus('error', 'Erro ao carregar');
                    this.appendTerminalOutput(`Erro ao inicializar: ${error.message}`, 'error');
                }
            },
            
            initTheme() {
                const savedTheme = localStorage.getItem('pythonCompilerTheme') || 'auto';
                this.currentTheme = savedTheme;
                this.applyTheme();
            },
            
            getSystemTheme() {
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            },
            
            applyTheme() {
                let theme;
                if (this.currentTheme === 'auto') {
                    theme = this.getSystemTheme();
                } else {
                    theme = this.currentTheme;
                }
                
                document.documentElement.setAttribute('data-theme', theme);
                const icon = document.querySelector('#themeToggle .material-icons');
                
                if (this.currentTheme === 'auto') {
                    icon.textContent = 'brightness_auto';
                } else if (theme === 'dark') {
                    icon.textContent = 'light_mode';
                } else {
                    icon.textContent = 'dark_mode';
                }
                
                if (this.editor) {
                    this.editor.setOption('theme', this.getEditorTheme());
                }
            },
            
            getEditorTheme() {
                let theme;
                if (this.currentTheme === 'auto') {
                    theme = this.getSystemTheme();
                } else {
                    theme = this.currentTheme;
                }
                return theme === 'dark' ? 'material-palenight' : 'default';
            },
            
            toggleTheme() {
                const themes = ['auto', 'light', 'dark'];
                const currentIndex = themes.indexOf(this.currentTheme);
                this.currentTheme = themes[(currentIndex + 1) % themes.length];
                localStorage.setItem('pythonCompilerTheme', this.currentTheme);
                this.applyTheme();
            },
            
            async loadPyodide() {
                this.pyodide = await loadPyodide({ indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.24.1/full/' });
                document.querySelector('.loading-subtext').textContent = 'Carregando matplotlib e numpy...';
                await this.pyodide.loadPackage(['matplotlib', 'numpy']);
                await this.pyodide.runPythonAsync(`import matplotlib; matplotlib.use('AGG')`);
            },
            
            async runCode() {
                if (this.isExecuting) return;
                const code = this.editor.getValue();
                this.clearTerminal(); 
                this.clearPlots();
                this.updateStatus('running', 'Executando...');
                document.getElementById('runBtn').disabled = true; 
                this.isExecuting = true;
                try {
                    await this.setupIO();
                    this.appendTerminalOutput("$ python seu_script.py\n", "success");
                    await this.pyodide.runPythonAsync(code);
                    await this.capturePlots();
                    this.appendTerminalOutput("\n‚úÖ Execu√ß√£o conclu√≠da com sucesso!", 'success');
                } catch (error) {
                    this.appendTerminalOutput(`\n‚ùå Erro durante a execu√ß√£o:\n${error.message}`, 'error');
                } finally {
                    this.updateStatus('ready', 'Pronto');
                    document.getElementById('runBtn').disabled = false; 
                    this.isExecuting = false;
                    if (this.inputResolver) { 
                        this.inputResolver(""); 
                        this.inputResolver = null; 
                    }
                }
            },
            
            async setupIO() {
                this.pyodide.setStdout({ batched: (text) => this.appendTerminalOutput(text) });
                this.pyodide.setStderr({ batched: (text) => this.appendTerminalOutput(text, 'error') });
                window.jsPythonInput = (prompt) => new Promise((resolve) => { 
                    this.inputResolver = resolve; 
                    this.showInputLine(prompt); 
                });
                await this.pyodide.runPythonAsync(`
                    import js
                    async def custom_input(prompt=""):
                        return await js.jsPythonInput(prompt)
                    __builtins__.input = custom_input
                `);
            },
            
            showInputLine(prompt) {
                const terminalContent = document.getElementById('terminalContent');
                const line = document.createElement('div'); 
                line.className = 'terminal-input-line';
                const promptSpan = document.createElement('span'); 
                promptSpan.className = 'terminal-prompt-text'; 
                promptSpan.textContent = prompt;
                const input = document.createElement('input'); 
                input.type = 'text'; 
                input.className = 'terminal-input';
                line.appendChild(promptSpan); 
                line.appendChild(input); 
                terminalContent.appendChild(line);
                input.focus(); 
                terminalContent.scrollTop = terminalContent.scrollHeight;
                const onEnter = (e) => {
                    if (e.key === 'Enter') {
                        const value = input.value;
                        input.removeEventListener('keydown', onEnter);
                        line.innerHTML = `<span class="terminal-prompt-text">${prompt}</span><span>${value}</span>`;
                        if (this.inputResolver) { 
                            this.inputResolver(value); 
                            this.inputResolver = null; 
                        }
                    }
                };
                input.addEventListener('keydown', onEnter);
            },
            
            appendTerminalOutput(text, type = 'output') {
                const terminalContent = document.getElementById('terminalContent');
                const lineElement = document.createElement('div');
                lineElement.className = `terminal-line terminal-${type}`;
                lineElement.textContent = text;
                terminalContent.appendChild(lineElement);
                terminalContent.scrollTop = terminalContent.scrollHeight;
            },
            
            clearTerminal() {
                document.getElementById('terminalContent').innerHTML = `<div class="terminal-line">Bem-vindo ao Terminal Python Online!</div><div class="terminal-line">Digite seu c√≥digo e clique em "Executar".</div>`;
                this.clearPlots(); 
                this.switchTab('terminal');
            },
            
            async capturePlots() {
                const plotCode = `import matplotlib.pyplot as plt, io, base64; plots_base64 = []; [plots_base64.append(base64.b64encode((buf := io.BytesIO(), fig := plt.figure(i), fig.savefig(buf, format='png', dpi=100), plt.close(fig), buf.seek(0), buf.read())[5]).decode('utf-8')) for i in plt.get_fignums()]; plots_base64`;
                const plots = await this.pyodide.runPythonAsync(plotCode);
                if (plots && plots.length > 0) {
                    const plotsContainer = document.getElementById('plots'); 
                    plotsContainer.innerHTML = ''; 
                    plotsContainer.classList.remove('empty');
                    plots.forEach((plot_b64) => { 
                        const img = document.createElement('img'); 
                        img.src = `data:image/png;base64,${plot_b64}`; 
                        plotsContainer.appendChild(img); 
                    });
                    this.appendTerminalOutput(`\nüìä ${plots.length} gr√°fico(s) gerado(s)! Veja na aba "Gr√°ficos".`, 'success'); 
                    this.switchTab('plots');
                }
            },
            
            clearPlots() { 
                const plots = document.getElementById('plots'); 
                plots.innerHTML = 'Os gr√°ficos aparecer√£o aqui...'; 
                plots.className = 'plot-container empty'; 
            },
            
            switchTab(tabName) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                const tab = document.querySelector(`.tab[onclick*="'${tabName}'"]`);
                const content = document.getElementById(`${tabName}Tab`);
                if (tab) tab.classList.add('active'); 
                if (content) content.classList.add('active');
            },
            
            updateStatus(state, text) {
                const dot = document.getElementById('statusDot'); 
                dot.className = 'status-dot';
                if (state === 'ready') dot.classList.add('ready');
                document.getElementById('statusText').textContent = text;
            },
            
            loadExample() {
                this.editor.setValue(`# Exemplo: Calculadora de IMC com Visualiza√ß√£o
import matplotlib.pyplot as plt

print("üè• Calculadora de IMC")
print("=" * 40)

# Lembre-se de usar "await"
nome = await input("Digite seu nome: ")
try:
    peso = float(await input("Digite seu peso (kg): "))
    altura = float(await input("Digite sua altura (m): "))

    if peso <= 0 or altura <= 0:
        print("Erro: Peso e altura devem ser valores positivos.")
    else:
        imc = peso / (altura ** 2)
        
        if imc < 18.5: classificacao = "Abaixo do peso"
        elif imc < 25: classificacao = "Peso normal"
        elif imc < 30: classificacao = "Sobrepeso"
        else: classificacao = "Obesidade"

        print(f"\\n{'='*40}")
        print(f"üìä Resultado para {nome}:")
        print(f"   IMC: {imc:.2f}")
        print(f"   Classifica√ß√£o: {classificacao}")
        print(f"{'='*40}")

        fig, ax = plt.subplots(figsize=(8, 5))
        categorias = ['Abaixo', 'Normal', 'Sobrepeso', 'Obesidade']
        cores = ['#3498db', '#2ecc71', '#f39c12', '#e74c3c']
        ax.bar(categorias, [18.5, 24.9, 29.9, 40], color=cores, alpha=0.7)
        ax.axhline(imc, color='red', linestyle='--', linewidth=2, label=f'Seu IMC: {imc:.1f}')
        ax.set_ylabel('IMC')
        ax.set_title(f'Classifica√ß√£o de IMC para {nome}')
        ax.legend()
        plt.tight_layout()

except ValueError:
    print("Erro: Digite apenas n√∫meros para peso e altura.")`);
                this.clearTerminal();
            }
        };
        
        // Detecta mudan√ßas no tema do sistema
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            if (pythonCompiler.currentTheme === 'auto') {
                pythonCompiler.applyTheme();
            }
        });
        
        window.addEventListener('load', () => pythonCompiler.init());
    </script>
</body>
</html>